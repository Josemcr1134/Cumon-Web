<!-- Backdrop -->
<div class="fixed inset-0 z-50">
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

  <!-- Modal -->
  <div class="relative z-10 h-full w-full flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-5xl max-h-[90vh] rounded-2xl shadow-2xl ring-1 ring-black/5 overflow-hidden
                animate-[fadeIn_180ms_ease-out]">
      <!-- Header -->
      <div class="px-6 py-4 border-b flex items-center justify-between">
        <div>
          <h3 class="text-lg font-semibold tracking-tight">Evidencias de entrega</h3>
          <p class="text-sm text-gray-500">{{ evidences?.length || 0 }} archivo(s)</p>
        </div>
        <button (click)="goAway()" class="inline-flex items-center justify-center rounded-full p-2
                                   hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/40"
          aria-label="Cerrar">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Body -->
      <div class="px-6 py-5 overflow-y-auto max-h-[calc(90vh-8rem)]">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
          <div *ngFor="let evidence of evidences; let i = index"
            class="group rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
            <!-- Card header -->
            <div class="px-4 py-3 bg-gray-50 border-b">
              <div class="flex items-start justify-between gap-2">
                <div class="min-w-0">
                  <h4 class="font-medium truncate" [title]="evidence.originalName">{{ evidence.originalName }}</h4>
                  <p class="text-xs text-gray-500">
                    {{ evidence.fechaHora | date:'medium' }}
                  </p>
                  <p *ngIf="evidence.descripcion" class="text-xs text-gray-600 mt-1 line-clamp-2">
                    {{ evidence.descripcion }}
                  </p>
                </div>
                <!-- Badge por tipo -->
                <span class="ml-2 shrink-0 inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium
                              border" [ngClass]="{
                        'bg-green-50 text-green-700 border-green-200': isImage(evidence.extension),
                        'bg-blue-50 text-blue-700 border-blue-200': isDoc(evidence.extension),
                        'bg-amber-50 text-amber-700 border-amber-200': isPdf(evidence.extension),
                        'bg-gray-50 text-gray-700 border-gray-200': !isImage(evidence.extension) && !isDoc(evidence.extension) && !isPdf(evidence.extension)
                      }">
                  <svg class="size-3.5" [innerHTML]="getIcon(evidence.extension)"></svg>
                  {{ evidence.extension?.replace('.', '').toUpperCase() || 'FILE' }}
                </span>
              </div>
            </div>

            <!-- Preview / Placeholder -->
            <div class="relative">
              <!-- Imagen -->
              <img *ngIf="isImage(evidence.extension)" [src]="evidence.urlFile || evidence.url"
                alt="Evidencia de entrega" class="w-full h-56 object-contain bg-white" />

              <!-- PDF -->
              <div *ngIf="isPdf(evidence.extension)"
                class="h-56 flex flex-col items-center justify-center text-center bg-gradient-to-b from-gray-50 to-white">
                <svg class="size-12 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="currentColor">
                  <path d="M14 2H6a2 2 0 00-2 2v16..." />
                </svg>
                <p class="mt-2 text-sm font-medium">Documento PDF</p>
                <p class="text-xs text-gray-500 line-clamp-1 max-w-[80%]">{{ evidence.originalName }}</p>
              </div>

              <!-- Otros documentos -->
              <div *ngIf="!isImage(evidence.extension) && !isPdf(evidence.extension)"
                class="h-56 flex flex-col items-center justify-center text-center bg-gradient-to-b from-gray-50 to-white">
                <svg class="size-12 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="currentColor">
                  <path d="M14 2H6a2 2 0 00-2 2v16..." />
                </svg>
                <p class="mt-2 text-sm font-medium">Archivo</p>
                <p class="text-xs text-gray-500 line-clamp-1 max-w-[80%]">{{ evidence.originalName }}</p>
              </div>

              <!-- Overlay de acciones -->
              <div
                class="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition flex items-center justify-center">
                <div class="opacity-0 group-hover:opacity-100 transition flex gap-2">
                  <a [href]="evidence.urlFile || evidence.url" target="_blank" rel="noreferrer"
                    class="px-3 py-1.5 text-xs font-medium rounded-lg bg-white/95 hover:bg-white shadow">
                    Ver
                  </a>

                  <button type="button" (click)="copyLink(evidence)"
                    class="px-3 py-1.5 text-xs font-medium rounded-lg bg-white/95 hover:bg-white shadow">
                    Copiar link
                  </button>

                </div>
              </div>
            </div>

            <!-- Footer compacto -->
            <div class="px-4 py-3 flex items-center justify-between">
              <div class="text-[11px] text-gray-500 truncate max-w-[65%]">
                {{ (evidence.sizeKb ? evidence.sizeKb + ' KB' : '') }}
              </div>
              <div class="flex gap-2">
                <a [href]="evidence.urlFile || evidence.url" target="_blank" rel="noreferrer"
                  class="text-xs text-primary hover:underline">Abrir</a>
                <button type="button" (click)="downloadEvidence(evidence)"
                  class="text-xs text-gray-600 hover:text-gray-800">Descargar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- VacÃ­o -->
        <div *ngIf="!evidences || evidences.length === 0" class="h-56 flex flex-col items-center justify-center">
          <svg class="size-12 text-gray-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14 2H6a2 2 0 00-2 2v16..." />
          </svg>
          <p class="mt-2 text-sm text-gray-500">Sin evidencias por mostrar</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-6 py-4 border-t flex items-center justify-end gap-3">
        <button (click)="goAway()" class="px-4 py-2 text-sm rounded-lg border hover:bg-gray-50">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>